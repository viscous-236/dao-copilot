console.log("[Wallet Bridge] Initializing wallet bridge..."),window.addEventListener("message",async e=>{if(e.source!==window)return;const{type:t,requestId:o}=e.data;if("REQUEST_WALLET_CONNECTION"===t){console.log("[Wallet Bridge] Received wallet connection request");try{if(!window.ethereum)throw new Error("MetaMask is not installed");const e=(await window.ethereum.request({method:"eth_requestAccounts"}))[0];console.log("[Wallet Bridge] Connected to wallet:",e),window.postMessage({type:"WALLET_CONNECTED",address:e,requestId:o},"*")}catch(e){console.error("[Wallet Bridge] Wallet connection error:",e),window.postMessage({type:"WALLET_ERROR",error:e.message||"Failed to connect wallet",requestId:o},"*")}}if("RPC_REQUEST"===t){const{method:t,params:r}=e.data;console.log("[Wallet Bridge] Received RPC request:",t,r);try{if(!window.ethereum)throw new Error("MetaMask is not installed");const e=await window.ethereum.request({method:t,params:r||[]});console.log("[Wallet Bridge] RPC response:",e),window.postMessage({type:"RPC_RESPONSE",result:e,requestId:o},"*")}catch(e){console.error("[Wallet Bridge] RPC error:",e),window.postMessage({type:"RPC_ERROR",error:e.message||"RPC request failed",requestId:o},"*")}}if("REQUEST_SWITCH_NETWORK"===t){const{chainId:t}=e.data;console.log("[Wallet Bridge] Received network switch request to chainId:",t);try{if(!window.ethereum)throw new Error("MetaMask is not installed");await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+t.toString(16)}]}),console.log("[Wallet Bridge] Successfully switched to network:",t),window.postMessage({type:"NETWORK_SWITCHED",chainId:t,requestId:o},"*")}catch(e){if(console.error("[Wallet Bridge] Network switch error:",e),4902===e.code&&84532===t)try{await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0x14a34",chainName:"Base Sepolia",nativeCurrency:{name:"Ethereum",symbol:"ETH",decimals:18},rpcUrls:["https://sepolia.base.org"],blockExplorerUrls:["https://sepolia.basescan.org"]}]}),console.log("[Wallet Bridge] Added and switched to Base Sepolia"),window.postMessage({type:"NETWORK_SWITCHED",chainId:t,requestId:o},"*")}catch(e){console.error("[Wallet Bridge] Failed to add network:",e),window.postMessage({type:"NETWORK_SWITCH_ERROR",error:e.message||"Failed to add network",requestId:o},"*")}else window.postMessage({type:"NETWORK_SWITCH_ERROR",error:e.message||"Failed to switch network",requestId:o},"*")}}}),console.log("[Wallet Bridge] Wallet bridge initialized successfully");